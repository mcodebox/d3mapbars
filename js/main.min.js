/*
 map-base 2017-06-08 
*/

function drawChart(dataArray){var dataColor=["#191919","#CC0001","#80B11A","#C4598B","#B2B2B2"],svgBars=d3.select("body").append("svg").attr("id","svg2").attr("width",chartWidth).attr("height",chartHeight),selection=svgBars.selectAll("rect").data(dataArray);selection.enter().append("rect").attr("x",function(d,i){return 25*i}).attr("width",15).attr("fill",function(d,i){return dataColor[i]}).merge(selection).attr("y",function(d,i){return yBarPosition[i]}).attr("height",function(d,i){return yBarHeight[i]}).transition().duration(700).attr("y",function(d,i){return chartHeight-chartHeight*(.02*d)}).attr("height",function(d,i){var newHeight=chartHeight*(.02*d);return yBarHeight[i]=newHeight,newHeight}),svgBars.selectAll("text").data(dataArray).enter().append("text").attr("class","barLabelText").attr("x",function(d,i){return 25*i}).attr("y",function(d,i){return yBarLabelPosition[i]}).transition().duration(700).attr("y",function(d,i){return chartHeight-chartHeight*(.02*d)}).attr("dx",7).attr("dy",8).text(function(d){return d}),selection.exit().remove()}var svg=d3.select("#svg1"),width=960,height=600,projection=d3.geoMercator().center([10.447596,51.163432]).scale(4*height).translate([width/2,height/2]),path=d3.geoPath().projection(projection);d3.json("data/b_laender.json",function(error,myjson){if(error)throw error;var tooltip=d3.select("body").append("div").attr("class","tooltip").attr("id","tooltip1").style("position","absolute").style("z-index","10").style("visibility","hidden").html("<div id='barBox'>.<div/>");svg.append("g").attr("class","b_laender").selectAll("path").data(topojson.feature(myjson,myjson.objects.b_laender).features).enter().append("path").attr("d",path).on("mouseover",function(d){var bl_name=d.properties.NAME_1,ergCDU=ergebnisse[d.id]["CDU/CSU"],ergSPD=ergebnisse[d.id].SPD,ergGRN=ergebnisse[d.id].GRUENE,ergLNK=ergebnisse[d.id].LINKE,ergSNS=ergebnisse[d.id].Sonstige;return drawChart([ergCDU,ergSPD,ergGRN,ergLNK,ergSNS]),document.getElementById("barBox").innerHTML="Name:<br><b>"+bl_name+"</b><hr><div id='textErgebnisse'> CDU/CSU: "+ergCDU+"%<br>SPD: "+ergSPD+"%<br>B90/DIE GRÃœNEN: "+ergGRN+"%<br>DIE LINKE: "+ergLNK+"%<br>Sonstige: "+ergSNS+"%<br></div><hr>",barBox.appendChild(svg2),tooltip.style("visibility","visible")}).on("mousemove",function(d){d.properties.NAME_1,ergebnisse[d.id]["CDU/CSU"],ergebnisse[d.id].SPD,ergebnisse[d.id].GRUENE,ergebnisse[d.id].LINKE,ergebnisse[d.id].Sonstige;return tooltip.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")}).on("mouseout",function(){return tooltip.style("visibility","hidden")}),svg.append("path").attr("class","state-borders").attr("d",path(topojson.mesh(myjson,myjson.objects.b_laender,function(a,b){return a!==b}))),svg.selectAll("text").data(topojson.feature(myjson,myjson.objects.b_laender).features).enter().append("text").attr("class","stateLabels").attr("transform",function(d){return"translate("+path.centroid(d)+")rotate(-10 20 20)"}).attr("dy",".35em").attr("x",-10).text(function(d){return d.properties.NAME_1})});var chartWidth=115,chartHeight=100,yBarPosition=chartHeight,yBarHeight=0;(yBarPosition=[]).push(chartHeight,chartHeight,chartHeight,chartHeight,chartHeight);var yBarHeight=[0,0,0,0,0],yBarLabelPosition=[];yBarLabelPosition.push(chartHeight,chartHeight,chartHeight,chartHeight,chartHeight);